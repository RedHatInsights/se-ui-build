"use strict";(self.webpackChunksmartevents_ui=self.webpackChunksmartevents_ui||[]).push([[119],{75649:(e,t,s)=>{s.r(t),s.d(t,{worker:()=>y});var a=s(4444),r=s(80515),i=s(389),n=s(44586);const d=[{kind:"Processor",id:"a72fb8e7-162b-4ae8-9672-f9f5b86fb3d7",name:"Processor one",type:"sink",href:"/api/v1/bridges/3543edaa-1851-4ad7-96be-ebde7d20d717/processors/a72fb8e7-162b-4ae8-9672-f9f5b86fb3d7",submitted_at:"2022-04-12T12:10:46.029400+0000",published_at:"2022-04-12T12:12:52.416527+0000",transformationTemplate:"Hi! This is a test message",status:"ready",action:{type:"Slack",parameters:{channel:"test",webhookUrl:"https://hooks.slack.com/services/XXXXXXXX/XXXXXXXXX/XXXXXXXXXXXXXXXXXXX"}}},{kind:"Processor",id:"fa373030-c0d2-11ec-9d64-0242ac120002",name:"Processor two",type:"sink",href:"/api/v1/bridges/3543edaa-1851-4ad7-96be-ebde7d20d717/processors/fa373030-c0d2-11ec-9d64-0242ac120002",submitted_at:"2022-04-15T12:10:46.029400+0000",published_at:"2022-04-15T12:12:52.416527+0000",filters:[{type:"StringEquals",key:"data.name",value:"John"}],status:"ready",action:{type:"Slack",parameters:{channel:"test",webhookUrl:"https://hooks.slack.com/services/XXXXXXXX/XXXXXXXXX/XXXXXXXXXXXXXXXXXXX"}}},{kind:"Processor",id:"f8f34af4-caed-11ec-9d64-0242ac120002",name:"Processor three",type:"source",href:"/api/v1/bridges/3543edaa-1851-4ad7-96be-ebde7d20d717/processors/f8f34af4-caed-11ec-9d64-0242ac120002",submitted_at:"2022-04-15T12:10:46.029400+0000",published_at:"2022-04-15T12:12:52.416527+0000",filters:[{type:"StringEquals",key:"data.name",value:"John"}],status:"accepted",source:{type:"Slack",parameters:{channel:"test",token:"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"}}}];var o,c,p=s(96486);const b=`${null!==(o="https://event-bridge-event-bridge-prod.apps.openbridge-dev.fdvn.p1.openshiftapps.com")?o:""}${null!==(c="/api/v1")?c:"/api/v1"}`,l=1e3,u=(0,i.factory)({bridge:{id:(0,i.primaryKey)(String),name:String,kind:String,href:String,submitted_at:String,published_at:String,status:String,endpoint:String},processor:{id:(0,i.primaryKey)(String),bridge:(0,i.oneOf)("bridge"),type:String,kind:String,name:String,href:String,submitted_at:String,published_at:String,status:String,filters:Array,transformationTemplate:String,action:{type:String,parameters:{channel:String,webhookUrl:String}},source:{type:String,parameters:{channel:String,token:String}}}});[{kind:"Bridge",id:"3543edaa-1851-4ad7-96be-ebde7d20d717",name:"Instance one",href:"/api/v1/bridges/3543edaa-1851-4ad7-96be-ebde7d20d717",status:"ready",submitted_at:"2022-02-24T13:34:00Z",published_at:"2022-02-24T13:35:00Z",endpoint:"https://3543edaa-1851-4ad7-96be-ebde7d20d717.apps.openbridge-dev.fdvn.p1.openshiftapps.com/events"},{kind:"Bridge",id:"830c8f0d-c677-492f-8d7e-0f81893fbba6",name:"Instance two",href:"/api/v1/bridges/830c8f0d-c677-492f-8d7e-0f81893fbba6",status:"ready",submitted_at:"2022-02-20T11:23:00Z",published_at:"2022-02-20T11:24:00Z",endpoint:"https://830c8f0d-c677-492f-8d7e-0f81893fbba6.apps.openbridge-dev.fdvn.p1.openshiftapps.com/events"},{kind:"Bridge",id:"ee22ce62-1f23-4dd7-b106-e4158baf8228",name:"Instance three",href:"/api/v1/bridges/ee22ce62-1f23-4dd7-b106-e4158baf8228",status:"accepted",submitted_at:"2022-02-15T12:03:00Z",published_at:"2022-02-15T12:04:00Z",endpoint:"https://ee22ce62-1f23-4dd7-b106-e4158baf8228.apps.openbridge-dev.fdvn.p1.openshiftapps.com/events"},{kind:"Bridge",id:"21ac90ba-76d2-4f88-b08b-2547ef359bae",name:"Instance four",href:"/api/v1/bridges/21ac90ba-76d2-4f88-b08b-2547ef359bae",status:"provisioning",submitted_at:"2022-02-10T16:34:00Z",published_at:"2022-02-10T16:35:00Z",endpoint:"https://21ac90ba-76d2-4f88-b08b-2547ef359bae.apps.openbridge-dev.fdvn.p1.openshiftapps.com/events"},{kind:"Bridge",id:"d4de4dd9-42fe-48ec-8ac7-42163e6e971a",name:"Instance five",href:"/api/v1/bridges/d4de4dd9-42fe-48ec-8ac7-42163e6e971a",status:"ready",submitted_at:"2022-02-05T13:58:00Z",published_at:"2022-02-05T13:59:00Z",endpoint:"https://d4de4dd9-42fe-48ec-8ac7-42163e6e971a.apps.openbridge-dev.fdvn.p1.openshiftapps.com/events"},{kind:"Bridge",id:"d7e13602-b046-4120-b377-15d61e21c31a",name:"Instance six",href:"/api/v1/bridges/d7e13602-b046-4120-b377-15d61e21c31a",status:"ready",submitted_at:"2022-02-01T12:02:00Z",published_at:"2022-02-01T12:03:00Z",endpoint:"https://d7e13602-b046-4120-b377-15d61e21c31a.apps.openbridge-dev.fdvn.p1.openshiftapps.com/events"},{kind:"Bridge",id:"3a7efbed-3562-4a95-9c32-f49d12d8cab2",name:"Instance seven",href:"/api/v1/bridges/3a7efbed-3562-4a95-9c32-f49d12d8cab2",status:"ready",submitted_at:"2021-12-25T21:46:00Z",published_at:"2021-12-25T21:47:00Z",endpoint:"https://3a7efbed-3562-4a95-9c32-f49d12d8cab2.apps.openbridge-dev.fdvn.p1.openshiftapps.com/events"},{kind:"Bridge",id:"fa648473-3662-4bbc-99ba-158d9ab95ccc",name:"Instance eight",href:"/api/v1/bridges/fa648473-3662-4bbc-99ba-158d9ab95ccc",status:"ready",submitted_at:"2021-12-20T12:21:00Z",published_at:"2021-12-20T12:22:00Z",endpoint:"https://fa648473-3662-4bbc-99ba-158d9ab95ccc.apps.openbridge-dev.fdvn.p1.openshiftapps.com/events"},{kind:"Bridge",id:"04f131c3-b34c-4ee2-b153-fbff0bb91ece",name:"Instance nine",href:"/api/v1/bridges/04f131c3-b34c-4ee2-b153-fbff0bb91ece",status:"ready",submitted_at:"2021-12-15T16:09:00Z",published_at:"2021-12-15T16:10:00Z",endpoint:"https://04f131c3-b34c-4ee2-b153-fbff0bb91ece.apps.openbridge-dev.fdvn.p1.openshiftapps.com/events"},{kind:"Bridge",id:"c28da8c0-05e4-42f3-a3fd-615cc7fbb382",name:"Instance ten",href:"/api/v1/bridges/c28da8c0-05e4-42f3-a3fd-615cc7fbb382",status:"ready",submitted_at:"2021-12-10T11:34:00Z",published_at:"2021-12-10T11:35:00Z",endpoint:"https://c28da8c0-05e4-42f3-a3fd-615cc7fbb382.apps.openbridge-dev.fdvn.p1.openshiftapps.com/events"},{kind:"Bridge",id:"a8c1cb57-0ab3-4ccb-8c55-ef8a8b166846",name:"Instance eleven",href:"/api/v1/bridges/a8c1cb57-0ab3-4ccb-8c55-ef8a8b166846",status:"ready",submitted_at:"2021-12-05T11:34:00Z",published_at:"2021-12-05T11:35:00Z",endpoint:"https://a8c1cb57-0ab3-4ccb-8c55-ef8a8b166846.apps.openbridge-dev.fdvn.p1.openshiftapps.com/events"},{kind:"Bridge",id:"e176d63b-6fdc-43ce-afc8-45160f456502",name:"Instance twelve",href:"/api/v1/bridges/e176d63b-6fdc-43ce-afc8-45160f456502",status:"ready",submitted_at:"2021-12-01T11:34:00Z",published_at:"2021-12-01T11:35:00Z",endpoint:"https://e176d63b-6fdc-43ce-afc8-45160f456502.apps.openbridge-dev.fdvn.p1.openshiftapps.com/events"}].map(((e,t)=>{const s=u.bridge.create(e);0===t&&d.map((e=>{u.processor.create(Object.assign(Object.assign({},e),{bridge:s}))}))}));const g=[r.r.get(`${b}/bridges`,((e,t,s)=>{var a,r;const i=parseInt(null!==(a=e.url.searchParams.get("page"))&&void 0!==a?a:"0"),n=parseInt(null!==(r=e.url.searchParams.get("size"))&&void 0!==r?r:"10"),d=u.bridge.findMany({take:n,skip:i*n,orderBy:{submitted_at:"desc"}});return t(s.status(200),s.delay(l),s.json({kind:"BridgeList",items:d,page:i,size:d.length,total:u.bridge.count()}))})),r.r.get(`${b}/bridges/:bridgeId`,((e,t,s)=>{const{bridgeId:a}=e.params,r=u.bridge.findFirst({where:{id:{equals:a}}});return r?t(s.status(200),s.delay(l),s.json(r)):t(s.status(404),s.delay(l),s.json(Object.assign(Object.assign({},m),{reason:`Bridge with id '${a}' for customer 'XXXXXXXX' does not exist`})))})),r.r.post(`${b}/bridges`,((e,t,s)=>{const{name:a}=e.body;if(u.bridge.findFirst({where:{name:{equals:a}}}))return t(s.status(400),s.json(Object.assign(Object.assign({},h),{reason:`Bridge with name '${a}' already exists for customer with id 'XXXXXXXX'`})));const r=(0,n.Z)(),i={kind:"Bridge",id:r,name:a,href:`/api/v1/bridges/${r}`,submitted_at:(new Date).toISOString(),status:"accepted"},d=u.bridge.create(i);return f("bridge","create",r,a.includes("wait"),a.includes("fail-create")),t(s.status(200),s.delay(l),s.json(d))})),r.r.delete(`${b}/bridges/:bridgeId`,((e,t,s)=>{const{bridgeId:a}=e.params,r=u.bridge.findFirst({where:{id:{equals:a}}});if(!r)return t(s.status(404),s.delay(l),s.json(Object.assign(Object.assign({},m),{reason:`Bridge with id '${a}' for customer 'XXXXXXXX' does not exist`})));return u.processor.count({where:{bridge:{id:{equals:a}}}})>0?t(s.status(400),s.delay(l),s.json(v)):(u.bridge.update({where:{id:{equals:a}},data:{status:"deprovision"}}),f("bridge","delete",a,r.name.includes("wait"),r.name.includes("fail-delete")),t(s.status(202),s.delay(l),s.json({})))})),r.r.get(`${b}/bridges/:bridgeId/processors`,((e,t,s)=>{var a,r;const{bridgeId:i}=e.params,n=parseInt(null!==(a=e.url.searchParams.get("page"))&&void 0!==a?a:"0"),d=parseInt(null!==(r=e.url.searchParams.get("size"))&&void 0!==r?r:"10");if(!u.bridge.findFirst({where:{id:{equals:i}}}))return t(s.status(404),s.delay(l),s.json(Object.assign(Object.assign({},m),{reason:`Bridge with id '${i}' for customer 'XXXXXXXX' does not exist`})));const o={where:{bridge:{id:{equals:i}}}},c=u.processor.count(o),p=u.processor.findMany(Object.assign({take:d,skip:n*d,orderBy:{submitted_at:"desc"}},o)).map((e=>X(e)));return t(s.status(200),s.delay(l),s.json({kind:"ProcessorList",items:p,page:n,size:p.length,total:c}))})),r.r.get(`${b}/bridges/:bridgeId/processors/:processorId`,((e,t,s)=>{const{bridgeId:a,processorId:r}=e.params;if(!u.bridge.findFirst({where:{id:{equals:a}}}))return t(s.status(404),s.delay(l),s.json(Object.assign(Object.assign({},m),{reason:`Bridge with id '${a}' for customer 'XXXXXXXX' does not exist`})));const i=u.processor.findFirst({where:{id:{equals:r}}});return i?t(s.status(200),s.delay(l),s.json(X(i))):t(s.status(404),s.delay(l),s.json(Object.assign(Object.assign({},m),{reason:`Processor with id '${r}' for customer 'XXXXXXXX' does not exist`})))})),r.r.post(`${b}/bridges/:bridgeId/processors`,((e,t,s)=>{var a;const{bridgeId:r}=e.params,{name:i,transformationTemplate:d,filters:o,action:c,source:p}=e.body,b=u.bridge.findFirst({where:{id:{equals:r}}});if(!b)return t(s.status(404),s.delay(l),s.json(Object.assign(Object.assign({},m),{reason:`Bridge with id '${r}' for customer 'XXXXXXXX' does not exist`})));if(u.processor.findFirst({where:{name:{equals:i},bridge:{id:{equals:r}}}}))return t(s.status(400),s.json(Object.assign(Object.assign({},h),{reason:`Processor with name '${i}' already exists for bridge with id ${r} for customer with id 'XXXXXXXXXX'`})));const g=(0,n.Z)(),v=Object.assign(Object.assign(Object.assign({kind:"Processor",id:g,type:c?"sink":"source",name:i,href:`/api/v1/bridges/${null!==(a=null==b?void 0:b.id)&&void 0!==a?a:""}/processors/${g}`,submitted_at:(new Date).toISOString(),status:"accepted",filters:o,transformationTemplate:d},c?{action:c}:{}),p?{source:p}:{}),{bridge:b}),y=u.processor.create(v);return f("processor","create",g,i.includes("wait"),i.includes("fail-create")),t(s.status(200),s.delay(l),s.json(X(y)))})),r.r.put(`${b}/bridges/:bridgeId/processors/:processorId`,((e,t,s)=>{const{bridgeId:a,processorId:r}=e.params,{name:i,filters:n,transformationTemplate:d,source:o,action:c}=e.body;if(!u.bridge.findFirst({where:{id:{equals:a}}}))return t(s.status(404),s.delay(l),s.json(Object.assign(Object.assign({},m),{reason:`Bridge with id '${a}' for customer 'XXXXXXXX' does not exist`})));if(!u.processor.findFirst({where:{id:{equals:r}}}))return t(s.status(404),s.delay(l),s.json(Object.assign(Object.assign({},m),{reason:`Processor with id '${r}' for customer 'XXXXXXXX' does not exist`})));const p=u.processor.findMany({where:{name:{equals:i},bridge:{id:{equals:a}}}});if(1===p.length&&p[0].id!==r||p.length>1)return t(s.status(400),s.json(Object.assign(Object.assign({},h),{reason:`Processor with name '${i}' already exists for bridge with id ${a} for customer with id 'XXXXXXXXXX'`})));const b=u.processor.update({where:{id:{equals:r}},data:Object.assign(Object.assign({name:i,status:"accepted",filters:n,transformationTemplate:d},c?{action:c}:{}),o?{source:o}:{})});return f("processor","create",r,i.includes("wait"),i.includes("fail-create")),t(s.status(200),s.delay(l),s.json(X(b)))})),r.r.delete(`${b}/bridges/:bridgeId/processors/:processorId`,((e,t,s)=>{const{bridgeId:a,processorId:r}=e.params;if(!u.bridge.findFirst({where:{id:{equals:a}}}))return t(s.status(404),s.delay(l),s.json(Object.assign(Object.assign({},m),{reason:`Bridge with id '${a}' for customer 'XXXXXXXX' does not exist`})));const i=u.processor.findFirst({where:{id:{equals:r},bridge:{id:{equals:a}}}});return i?(u.processor.update({where:{id:{equals:r}},data:{status:"deprovision"}}),f("processor","delete",r,i.name.includes("wait"),i.name.includes("fail-delete")),t(s.status(202),s.delay(l),s.json({}))):t(s.status(404),s.delay(l),s.json(Object.assign(Object.assign({},m),{reason:`Processor with id '${a}' for customer 'XXXXXXXX' does not exist`})))}))],f=(e,t,s,a,r)=>{const i=a?45e3:8e3,n="processor"===e?(e,t)=>{u.processor.update({where:{id:{equals:e}},data:{status:()=>t,published_at:e=>"ready"===t?(new Date).toISOString():e}})}:(e,t)=>{u.bridge.update({where:{id:{equals:e}},data:{status:()=>t,endpoint:s=>"ready"===t?`https://ob-${e}.apps.openbridge-dev.fdvn.p1.openshiftapps.com/events`:s,published_at:e=>"ready"===t?(new Date).toISOString():e}})},d="create"===t?"provisioning":"deleting",o="create"===t?"ready":"deleted";setTimeout((()=>{n(s,d)}),i),setTimeout((()=>{n(s,r?"failed":o)}),2*i),"delete"!==t||r||setTimeout((()=>{"processor"===e?(e=>{u.processor.delete({where:{id:{equals:e}}})})(s):(e=>{u.bridge.delete({where:{id:{equals:e}}})})(s)}),2.2*i)},X=e=>{var t;const s=["bridge"];return(null===(t=e.filters)||void 0===t?void 0:t.length)||s.push("filters"),""===e.transformationTemplate&&s.push("transformationTemplate"),"source"===e.type?s.push("action"):s.push("source"),(0,p.omit)(e,s)},m={kind:"Error",id:"4",href:"/api/v1/errors/4",code:"OPENBRIDGE-4"},h={kind:"Error",id:"1",href:"/api/v1/errors/1",code:"OPENBRIDGE-1"},v={kind:"Error",id:"2",href:"/api/v1/errors/2",code:"OPENBRIDGE-2",reason:"It is not possible to delete a Bridge instance with active Processors."},y=(0,a.setupWorker)(...g)},19474:(e,t,s)=>{s.r(t);var a=s(75418),r=s.n(a),i=s(66235),n=s(70655),d=s(98068),o=(s(49901),s(74651),s(99521),s(15202),s(56594),s(99922));const c=s.p+"f940137c.svg";var p=s(82786),b=s.n(p);let l;const u=()=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){l||(yield g())})),g=()=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{l=b()({realm:"redhat-external",url:"https://sso.redhat.com/auth/",clientId:"cloud-services"}),l&&(yield l.init({onLoad:"login-required",promiseType:"native"}))}catch(e){l=void 0,console.warn("Auth: Unable to initialize keycloak. Client side will not be configured to use authentication",e)}})),f=()=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){return yield null==l?void 0:l.updateToken(50),(null==l?void 0:l.token)?l.token:(console.error("No keycloak token available"),"foo")})),X=()=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){return yield null==l?void 0:l.updateToken(50),(null==l?void 0:l.tokenParsed)?l.tokenParsed:(console.error("No keycloak token available"),{})})).then((e=>{var t;return null!==(t=e.username)&&void 0!==t?t:""})),m=({children:e})=>{const[t,s]=(0,a.useState)(!0),[i,c]=(0,a.useState)(!0),[p,b]=(0,a.useState)(!1),u=r().createElement(o.PageHeaderTools,null,r().createElement(o.PageHeaderToolsGroup,null,r().createElement(o.Button,{variant:"tertiary",onClick:()=>{(0,n.__awaiter)(void 0,void 0,void 0,(function*(){l&&(yield l.logout())}))}},"Logout"))),g=r().createElement(o.PageHeader,{logo:r().createElement(h,null),showNavToggle:!0,isNavOpen:t,headerTools:u,onNavToggle:i?()=>{b(!p)}:()=>{s(!t)},"aria-label":"global_navigation"}),f=r().createElement(o.Nav,{id:"nav-primary-simple",role:"navigation",theme:"dark","aria-label":"global"},r().createElement(o.NavList,{id:"nav-list-simple"},r().createElement(o.NavItem,{id:"connectors",ouiaId:"smart-events"},r().createElement(d.NavLink,{to:"/",activeClassName:"pf-m-current"},"SmartEvents")))),X=r().createElement(o.PageSidebar,{theme:"dark",nav:f,isNavOpen:i?p:t});return r().createElement(o.Page,{mainContainerId:"primary-app-container",role:"main",header:g,sidebar:X,onPageResize:e=>{c(e.mobileView)}},e)};function h(){const e=(0,d.useHistory)();return r().createElement("img",{src:c,onClick:function(){e.push("/")},alt:"PatternFly Logo"})}var v=s(18610),y=s(64120),k=s(20807);const w=()=>{const[e,t]=(0,a.useState)(!1);(0,a.useEffect)((()=>{(0,n.__awaiter)(void 0,void 0,void 0,(function*(){yield u(),t(!0)}))}),[]);return r().createElement(y.I18nProvider,{lng:"en",resources:{en:{common:()=>s.e(389).then(s.t.bind(s,3389,19)),openbridgeTempDictionary:()=>s.e(497).then(s.t.bind(s,49497,19))}},debug:!0},r().createElement(a.Suspense,{fallback:r().createElement(y.AppServicesLoading,null)},r().createElement(d.BrowserRouter,{basename:"/"},e&&r().createElement(k.E,{apiBaseUrl:"https://event-bridge-event-bridge-prod.apps.openbridge-dev.fdvn.p1.openshiftapps.com",getToken:f,getUsername:X},r().createElement(m,null,r().createElement(v.Z,null))))))},_=()=>{const{worker:e}=s(75649);e.start();return r().createElement(k.E,{getToken:()=>Promise.resolve("dummy"),getUsername:()=>Promise.resolve("username"),apiBaseUrl:"https://event-bridge-event-bridge-prod.apps.openbridge-dev.fdvn.p1.openshiftapps.com"},r().createElement(y.I18nProvider,{lng:"en",resources:{en:{common:()=>s.e(389).then(s.t.bind(s,3389,19)),openbridgeTempDictionary:()=>s.e(497).then(s.t.bind(s,49497,19))}},debug:!0},r().createElement(a.Suspense,{fallback:r().createElement(y.AppServicesLoading,null)},r().createElement(d.BrowserRouter,{basename:"/"},r().createElement(m,null,r().createElement(v.Z,null))))))};"MISSING_ENV_VAR".MOCKED_API?i.render(a.createElement(_,null),document.getElementById("root")):i.render(a.createElement(w,null),document.getElementById("root"))}}]);
//# sourceMappingURL=119.38bf161c.js.map